

<!DOCTYPE html>
<head>
  <meta charset="utf-8">
  <meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Running integration tests manually &mdash; haddock3 3.0.0 documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../_static/css/theme.min.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/theme.min.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Contributing to HADDOCK3" href="../contributing.html" />
    <link rel="prev" title="Testing" href="index.html" /> 

</head>

<body>
    <header>
        <div class="container">
            <a class="site-nav-toggle hidden-lg-up"><i class="icon-menu"></i></a>
            <a class="site-title" href="../index.html">
                haddock3
            </a>
        </div>
    </header>


<div class="breadcrumbs-outer hidden-xs-down">
    <div class="container">
        















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="breadcrumbs">
    
      <li><a href="../index.html">Docs</a></li>
        
          <li><a href="index.html">Testing</a></li>
        
      <li>Running integration tests manually</li>
    
    
      <li class="breadcrumbs-aside">
        
            
            <a href="../_sources/testing/integration_tests.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>
</div>
    </div>
</div>
    <div class="main-outer">
        <div class="container">
            <div class="row">
                <div class="col-12 col-lg-3 site-nav">
                    
<div role="search">
    <form class="search" action="../search.html" method="get">
        <div class="icon-input">
            <input type="text" name="q" placeholder="Search" />
            <span class="icon-search"></span>
        </div>
        <input type="submit" value="Go" class="d-hidden" />
        <input type="hidden" name="check_keywords" value="yes" />
        <input type="hidden" name="area" value="default" />
    </form>
</div>
                    <div class="site-nav-tree">
                        
                            
                            
                                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../intro.html">A brief introduction to HADDOCK3</a></li>
<li class="toctree-l1"><a class="reference internal" href="../INSTALL.html">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../INSTALL.html#clone-this-repository">1. Clone this repository:</a></li>
<li class="toctree-l2"><a class="reference internal" href="../INSTALL.html#create-a-virtual-environment-with-python-3-9-and-install-dependencies">2 Create a virtual environment with Python 3.9+ and install dependencies:</a></li>
<li class="toctree-l2"><a class="reference internal" href="../INSTALL.html#install-the-haddock3-package-and-command-line-clients">3. Install the HADDOCK3 package and command line clients</a></li>
<li class="toctree-l2"><a class="reference internal" href="../INSTALL.html#make-a-cns-binary-shortcut-to-the-expected-path">4. Make a CNS binary shortcut to the expected path:</a></li>
<li class="toctree-l2"><a class="reference internal" href="../INSTALL.html#keep-your-installation-up-to-date">5. Keep your installation up to date</a></li>
<li class="toctree-l2"><a class="reference internal" href="../INSTALL.html#optional-install-mpi-libraries-if-you-intend-to-run-haddock3-with-mpi">6. (Optional) Install MPI libraries if you intend to run HADDOCK3 with MPI</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../INSTALL.html#installing-third-party-packages">Installing third-party packages</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../INSTALL.html#lightdock"><code class="docutils literal notranslate"><span class="pre">lightdock</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../INSTALL.html#gdock"><code class="docutils literal notranslate"><span class="pre">gdock</span></code></a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../USAGE.html">Usage</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../USAGE.html#run-haddock3">Run HADDOCK3</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../examples.html">Workflow Examples</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../examples.html#docking-antibogy-antigen">docking-antibogy-antigen</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples.html#docking-protein-dna">docking-protein-dna</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples.html#docking-protein-homotrimer">docking-protein-homotrimer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples.html#docking-protein-ligand">docking-protein-ligand</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples.html#docking-protein-ligand-shape">docking-protein-ligand-shape</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples.html#docking-protein-peptide">docking-protein-peptide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples.html#docking-protein-protein">docking-protein-protein</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples.html#refine-complex">refine-complex</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples.html#scoring">scoring</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples.html#docking-multiple-ambig">docking-multiple-ambig</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/index.html">Advanced features</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/index.html#haddock3-functionalities">HADDOCK3 functionalities</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/index.html#tutorials-for-developers">Tutorials for developers</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../clients/index.html">Command-line interfaces</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../clients/clihd3.html">Run HADDOCK3</a></li>
<li class="toctree-l2"><a class="reference internal" href="../clients/clicfg.html">Retrieve config</a></li>
<li class="toctree-l2"><a class="reference internal" href="../clients/cliscore.html">Calculate score</a></li>
<li class="toctree-l2"><a class="reference internal" href="../clients/clipp.html">PDB preprocessing client</a></li>
<li class="toctree-l2"><a class="reference internal" href="../clients/clicp.html">Copy steps to new run</a></li>
<li class="toctree-l2"><a class="reference internal" href="../clients/cliclean.html">Clean HADDOCK3 runs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../clients/cliunpack.html">Unpack HADDOCK3 run</a></li>
<li class="toctree-l2"><a class="reference internal" href="../clients/climpi.html">HADDOCK3 MPI Run</a></li>
<li class="toctree-l2"><a class="reference internal" href="../clients/clibm.html">Benchmark Client</a></li>
<li class="toctree-l2"><a class="reference internal" href="../clients/clidmn.html">Benchmark Daemon</a></li>
<li class="toctree-l2"><a class="reference internal" href="../clients/clianalyse.html">Analysis client</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../modules/index.html">Modules</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../modules/topology/index.html">Topology Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/sampling/index.html">Sampling Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/refinement/index.html">Model Refinement Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/scoring/index.html">Scoring Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/analysis/index.html">Analysis Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/extras/index.html">Extra modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/index.html#module-haddock.modules">Parent code for modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/index.html#module-haddock.modules.base_cns_module">Parent code for CNS modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/index.html#general-default-parameters">General Default parameters</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Testing</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Running integration tests manually</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../contributing.html">Contributing to HADDOCK3</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../contributing.html#contributing-new-code">1. Contributing new code</a></li>
<li class="toctree-l2"><a class="reference internal" href="../contributing.html#contributing-with-documentation">2. Contributing with documentation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../citing.html">Citing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/index.html">Library Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../reference/core/index.html">Core Reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/libs/index.html">Libs Reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/gear/index.html">Gear Reference</a></li>
</ul>
</li>
</ul>

                            
                        
                    </div>
                </div>
                <div class="col-12 col-lg-9">
                    <div class="document">
                        
                            
  <section id="running-integration-tests-manually">
<h1>Running integration tests manually<a class="headerlink" href="#running-integration-tests-manually" title="Permalink to this heading">¶</a></h1>
<p><em>This documentation is for developers.</em></p>
<p>The integration tests ensure HADDOCK3 workflows work correctly by performing
short docking or analysis on testing systems. With these tests, we evaluate if
the final scoring values in the developing branch are equal to those obtained in
the <code class="docutils literal notranslate"><span class="pre">main</span></code> branch.</p>
<p>You can run the integration tests locally using our helper scripts and
following the guidelines here.</p>
<p>For a pull request to be accepted, it must pass these integration tests. So we
kindly ask you to run them before submitting a pull request. We are currently
working on incorporating these tests into our automatic CI pipelines.</p>
<p>Running the integration tests for a single branch takes about 1 hour using 8 CPU
cores in a AMD EPYC 7451 24-Core Processor. In case you do not have the computer
power to run these tests, ask us and we will run them for you.</p>
<p><strong>How to correctly set up and run the integration tests?</strong></p>
<p>The easiest way is to have two installations of haddock3:
one fixed at the <code class="docutils literal notranslate"><span class="pre">main</span></code> branch and another with your developments.</p>
<section id="install-haddock3-main-branch-separately">
<h2>1. Install HADDOCK3 main branch separately<a class="headerlink" href="#install-haddock3-main-branch-separately" title="Permalink to this heading">¶</a></h2>
<p>First, you should install HADDOCK3 main branch in a separate folder and
python environment:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git<span class="w"> </span>clone<span class="w"> </span>--recursive<span class="w"> </span>https://github.com/haddocking/haddock3<span class="w"> </span>haddock3main
<span class="nb">cd</span><span class="w"> </span>haddock3main
</pre></div>
</div>
<p>Rename the conda env name in requirements.yml file</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sed</span> <span class="o">-</span><span class="n">i</span> <span class="s1">&#39;s/haddock3/haddock3main/g&#39;</span> <span class="n">requirements</span><span class="o">.</span><span class="n">yml</span>
</pre></div>
</div>
<p>Proceed to install the HADDOCK3 main following the installation
instructions in the repository.</p>
<p>This repository and environment will be the ones you will use to run the
test examples from the <code class="docutils literal notranslate"><span class="pre">main</span></code> branch.</p>
<p>Once installed, you don’t need to install this “main” repository again for
future occasions. You can keep using it to test all your developments.</p>
</section>
<section id="running-the-tests-in-the-main">
<h2>3. Running the tests in the <code class="docutils literal notranslate"><span class="pre">main</span></code><a class="headerlink" href="#running-the-tests-in-the-main" title="Permalink to this heading">¶</a></h2>
<p>Before running the integration tests, ensure the reference repository <code class="docutils literal notranslate"><span class="pre">main</span></code>
branch is up-to-date.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>haddock3main
git<span class="w"> </span>checkout<span class="w"> </span>main
git<span class="w"> </span>pull
</pre></div>
</div>
<p>Remember to activate the corresponding python environment.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>conda<span class="w"> </span>activate<span class="w"> </span>haddock3main
</pre></div>
</div>
<p>Or, if you used <code class="docutils literal notranslate"><span class="pre">venv</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">source</span><span class="w"> </span>venv/bin/activate
</pre></div>
</div>
<p>Navigate to the <code class="docutils literal notranslate"><span class="pre">examples/</span></code> folder and execute the tests:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>examples/
python<span class="w"> </span>run_tests.py<span class="w"> </span>-b
</pre></div>
</div>
<p>This script will run all the test cases in the <code class="docutils literal notranslate"><span class="pre">examples/</span></code> folder (<code class="docutils literal notranslate"><span class="pre">*-test.cfg</span></code>
files) and stop if any of the tests break. For help, see <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">run_tests.py</span> <span class="pre">-h</span></code>.</p>
</section>
<section id="running-the-tests-on-your-branch">
<h2>4. Running the tests on your branch<a class="headerlink" href="#running-the-tests-on-your-branch" title="Permalink to this heading">¶</a></h2>
<p>Navigate to your development repository and activate the haddock3 environment -
you are likely on a different terminal window.</p>
<p>Run the tests the same way as before by navigating to the <code class="docutils literal notranslate"><span class="pre">examples/</span></code> folder and
executing the tests:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>examples/
python<span class="w"> </span>run_tests.py<span class="w"> </span>-b
</pre></div>
</div>
</section>
<section id="comparing-both-runs">
<h2>5. Comparing both runs<a class="headerlink" href="#comparing-both-runs" title="Permalink to this heading">¶</a></h2>
<p>Once tests in the <code class="docutils literal notranslate"><span class="pre">main</span></code> and your development branch complete, that is, all
<code class="docutils literal notranslate"><span class="pre">*-test.cfg</span></code> files were executed, you can compare their CAPRI scores.</p>
<p>Inside the <code class="docutils literal notranslate"><span class="pre">examples/</span></code> folder of your development branch, run:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>compare-runs.py<span class="w"> </span>-r<span class="w"> </span>&lt;path-to-haddock-main-examples-folder&gt;
</pre></div>
</div>
<p>This command will tell you if there are any differences in the CAPRI tables:
missing rows or columns and different values. Numeric scores are evaluated with
0.001 tolerance.</p>
<p>If there are differences, likely something went wrong unless you are developing
code that explicitly affects the CAPRI scores. If that is the case, explain it
in the pull request description.</p>
</section>
<section id="additional-considerations">
<h2>Additional considerations<a class="headerlink" href="#additional-considerations" title="Permalink to this heading">¶</a></h2>
<section id="tests-breaking-with-run-tests-py">
<h3>Tests breaking with <code class="docutils literal notranslate"><span class="pre">run_tests.py</span></code><a class="headerlink" href="#tests-breaking-with-run-tests-py" title="Permalink to this heading">¶</a></h3>
<p>Tests break during the <code class="docutils literal notranslate"><span class="pre">run_test.py</span></code> step if the new code breaks the core
HADDOCK3 workflow. You should work towards correcting those errors first. Once
the workflows execute completely, you can then compare the CAPRI tables.</p>
</section>
<section id="running-on-a-cluster">
<h3>Running on a cluster<a class="headerlink" href="#running-on-a-cluster" title="Permalink to this heading">¶</a></h3>
<p>Following the instructions here, the test cases will run locally on your
computer. But if you have access to a job scheduling system in a cluster, you
can prepare a <code class="docutils literal notranslate"><span class="pre">job</span></code> script and launch the job as you would to for any other
related process.</p>
</section>
<section id="running-individual-test-cases">
<h3>Running individual test cases<a class="headerlink" href="#running-individual-test-cases" title="Permalink to this heading">¶</a></h3>
<p>If you want to compare a particular test case only, for example, two different
runs for the <code class="docutils literal notranslate"><span class="pre">docking-protein-protein/docking-protein-protein-test.cfg</span></code>, run:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>compare_runs.py<span class="w"> </span>-r1<span class="w"> </span>&lt;PATH-TO-RUN1&gt;<span class="w"> </span>-r2<span class="w"> </span>&lt;PATH-TO-RUN2&gt;
</pre></div>
</div>
<p><em>Thanks, and enjoy developing and using HADDOCK3 :-)</em></p>
</section>
</section>
</section>


                        
                    </div>
                </div>
            </div>
        </div>
    </div>    


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'3.0.0',
            LANGUAGE:'en',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
    <script type="text/javascript" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/sphinx_highlight.js"></script>
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  
    <div class="footer" role="contentinfo">
        <div class="container">
            &#169; Copyright 2022, BonvinLab.
        Last updated on Apr 11, 2023.
        Created using <a href="http://sphinx-doc.org/">Sphinx</a> 6.1.3.
        </div>
    </div>  

</body>
</html>